# CeBRA - BLUE System-Tests

This projects purpose is to reduce developer effort on testing the BLUE API on a deployed environment. \
In order to reduce programming effort and make the tests easily understandable, also for non developers, [Cucumber](https://cucumber.io) is used.\

## Project Structure
### src - folder
Contains actual api calls to the endpoints provided by blue. Each of BLUE's endpoints will be handled by one separate API file, like the files API, the metadata API or the folder API.\
In Addition the authentication is handled separately even though it is not directly part of the BLUE api.

### features - folder
The features folder itself contains .feature files, the step definitions and additional configuration settings in the support folder.

#### .feature - files
* contains the actual test specifications / use cases
* each .feature file should contain logically related use cases
* .feature file shall generally speaking not be API endpoint specific (like the api files in the src folder)

#### stepdefinitions
* a x.stepdef.ts file shall be api specific like the api files in the src folder
* e.g. all metadata specific configuration, api calls or validation should be done in the metadata.stepdef.ts file
* used to configure world configuration for further steps
* can use existing world configuration for validation stepdefintitions
* should be as short and small as possible

#### support - folder
* hooks.ts
  * sed to reset world in between tests
  * has tag configuration to be able to ignore certain scenarios when running tests
* setup.ts
  * used to define custom world
* world.ts
  * custom world
  * used to define variables to be shared across multiple stepdefinitions
  * reads .env file and provides contend via "this.worldEnv" object (stepdefinitions have no access to process.env)

#### report - folder
* will be generated after first test run
* should not be committed
* contains test report with html and json files

## Technische Daten

| Eigenschaft         | Wert                         | Eigenschaft     | Wert   |
|---------------------|------------------------------|-----------------|--------|
| Gewicht             | 32g (inkl. Batterie)         |Farbe            | grau   |
| Abmessungen         | 98×98×33mm                   |max. Leistung    | 120W   |
| Flugzeit            | Bis zu 9Minuten              |Spannung         | 5 V    |
| Reichweite          | Bis zu 1,5km                 |Spannung Ruhezustand | 2V |
| Batterie            | 320mAh LiPo                  |Aufbaudauer      | 2h     |
| Ladezeit            | Ca. 50Minuten                |
| Kameraauflösung     | 1280×720 Pixel               |
| Prozessor           | STM32H743ZI (400MHz)         |


## Creating a complete new feature
1) create x.feature file
2) Define Scenario
    1) reuse existing stepdefinitions
    2) create new stepdefinition
3) Configure stepdefinitions
   1) make sure step definition variables have correct regex when using variables
   2) add variables/ parameters to stepdef functions (because they are missing for autogenerated definitions, eat least on jetbrains IDEs)
   3) inside stepdefinition use x.api.ts files
4) opt. adapt CustomWorld in support/world.ts
   1) to configure new variables/settings which shall be shared between stepdefinitions
   2) dont forget to configure also resetValues in world
5) Setup api calls
   1) use src folder for this


## Run Tests

### Configure .env
* take the .env.example and save it as .env file
* fill all variables
  * IDP_CLIENT_ID: should be public client id
  * IDP_CLIENT_SECRET: not needed right now
  * IDP_URL: most likely IDP-QA url
  * IDP_REFRESH_TOKEN: can be taken from session object using dev tools in browser when opening blue frontend
  * BLUE_URL: could be blue dev/test/preprod

### Execute Tests
To run the tests simply execute:
```bash
npm test
```
Afterwards the reports will be generated / updated.